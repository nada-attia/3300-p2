<!DOCTYPE html>
<html>
<head>
  <script src='https://d3js.org/d3.v7.min.js'></script>
  <title>Project 2</title>
</head>
<body>
  <style>
    html {
      font-family: sans-serif;
    }

    /* used w3schools.com for slider styling inspo */
    .slider {
      -webkit-appearance: none;
      width: 30%;
      height: 10px;
      background: lightgrey;
      outline: none;
    }
    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 10px;
      height: 20px;
      background:steelblue;
      cursor: pointer;
    }
    .gridlines .domain {
      display: none;
    }

    .gridlines line {
      stroke: #444;
    }
  </style>

  
  <div style='padding: 5px 20px'>
    <div style='padding-bottom: 40px'>
      <p>
        Selected Year: <b>2016</b> <br/> 
        <span style='font-size: 12px'>Use the slider below to change the selected year.</span>
      </p>
      <input type='range' min='1985' max='2016' value='2016' step='1' class='slider'>  
    </div>
    
    <!-- generated background image using figma -->
    <svg id='field' width='700' height='650' viewBox='0 0 700 612' fill='none' xmlns='http://www.w3.org/2000/svg'>
      <path d='M350 0C175.629 0 30.5457 104.819 0 243.194L350 595.056L700 243.194C669.454 104.819 524.37 0 350 0Z' fill='#84AB7E'/>
      <path d='M350.923 210C249.832 210 151.148 281.57 117 361.5L350.923 596L582.587 361.5C549.066 281.57 452.014 210 350.923 210Z' fill='#E6C5B3'/>
      <circle cx='349.423' cy='557' r='55' fill='#E6C5B3'/>
      <rect x='207.499' y='425.626' width='198.711' height='202.854' transform='rotate(-45 207.499 425.626)' fill='#84AB7E'/>
      <circle cx='349.721' cy='314.291' r='38.2906' fill='#E6C5B3'/>
      <path d='M268.581 427.339C268.581 408.306 254.694 392.516 236.5 389.549L192 427.339L236.5 465.129C254.694 462.162 268.581 446.372 268.581 427.339Z' fill='#E6C5B3'/>
      <path d='M427 427.79C427 446.823 440.887 462.613 459.081 465.579L503.581 427.79L459.081 390C440.887 392.967 427 408.757 427 427.79Z' fill='#E6C5B3'/>
      <circle cx='349.721' cy='541.299' r='38.2906' fill='#E6C5B3'/>
      <circle cx='352.5' cy='425.5' r='31.5' fill='#E6C5B3'/>
      </svg>
    <svg width=500 height=600 id='barchart'></svg>
    
  </div>

  <script>
    const svgField = d3.select('svg#field');
    const svgChart = d3.select('svg#barchart');
    var year = 2016;

    const positions = ['G_p', 'G_c', 'G_1b', 'G_2b', 'G_3b', 'G_ss', 'G_lf', 'G_cf', 'G_rf']
    const positionsOnField = {
      'G_p': {
        'x': 353,
        'y': 426,
        'name': 'Pitcher'
      },
      'G_c': {
        'x': 350,
        'y': 560,
        'name': 'Catcher'
      },
      'G_1b': {
        'x': 510,
        'y': 365,
        'name': 'First Baseman'
      },
      'G_2b': {
        'x': 440,
        'y': 275,
        'name': 'Second Baseman'
      },
      'G_3b': {
        'x': 190,
        'y': 365,
        'name': 'Third Baseman'
      },
      'G_ss': {
        'x': 260,
        'y': 274,
        'name': 'Short Stop'
      },
      'G_lf': {
        'x': 150,
        'y': 170,
        'name': 'Left Fielder'
      },
      'G_cf': {
        'x': 350,
        'y': 105,
        'name': 'Center Fielder'
      },
      'G_rf': {
        'x': 550,
        'y': 170,
        'name': 'Center Fielder'
      }
    }

    function displayField() {
      // clean up
      positions.forEach(pos => {
        positionsOnField[pos]['total salary'] = 0;
        positionsOnField[pos]['number of players'] = 0;
      })
      
      const filePath = './yearly-data/'+ year + '.csv';
      d3.csv(filePath).then( data => {
      data.forEach(d => {
        positions.forEach(pos => {
          if (Number(d[pos]) > 0) {
            positionsOnField[pos]['total salary'] += Number(d['salary']);
            positionsOnField[pos]['number of players'] ++;
          } 
        })
      });


      positions.forEach(pos => {
        positionsOnField[pos]['average salary'] = positionsOnField[pos]['total salary']/positionsOnField[pos]['number of players']
      })

      const avgSalaryExtent = d3.extent(positions, d => positionsOnField[d]['average salary']);
      const avgSalaryScale = d3.scaleLinear().domain(avgSalaryExtent).range([10, 30]);

      const positionsCircles = svgField.selectAll('circle.positions').data(positions)
                                        .join('circle')
                                        .attr('cx', d => positionsOnField[d]['x'])
                                        .attr('cy', d => positionsOnField[d]['y'])
                                        .attr('r', d => avgSalaryScale(positionsOnField[d]['average salary']))
                                        .attr('id', d => d)
                                        .attr('class', 'positions')
                                        .attr('fill', 'steelblue')
                                        .attr('opacity', 0.5);
                                    

      positionsCircles.on('mouseover', function() {
        d3.select(this)
          .attr('opacity', 1)
          .attr('stroke', 'black')
          .attr('stroke-width', 2);
        const posID = d3.select(this).attr('id');
        const pos = positionsOnField[posID]['name'];
        svgChart.append('text')
          .attr('id', 'title')
          .attr('x', 250)
          .attr('y', 20)
          .attr('text-anchor', 'middle')
          .attr('dominant-baseline', 'central')
          .text('Top 10 Highest Paid ' + pos + ' in ' + year)
          .style('font-size', 18);

        svgField.append('text')
                .attr('x', 550)
                .attr('y', 550)
                .text('Average Salary of ' + pos)
                .attr('id', 'avgSalaryPosText')
                .attr('text-anchor', 'middle')
                .attr('dominant-baseline', 'central')
                .attr('fill', 'black');
                
        svgField.append('text')
                .attr('x', 550)
                .attr('y', 570)
                .text('Average Salary of ' + pos + ':')
                .attr('id', 'avgSalaryText')
                .text('$'+ d3.format(',r')(Math.floor(positionsOnField[posID]['average salary'])))
                .attr('fill', 'steelblue')
                .attr('text-anchor', 'middle')
                .attr('dominant-baseline', 'central')

        displayChart();
      });

      positionsCircles.on('mouseout', function() {  
        d3.select(this)
          .attr('opacity', 0.5)
          .attr('stroke', 'none');      
        d3.select('#title').remove();
        d3.select('#avgSalaryPosText').remove();
        d3.select('#avgSalaryText').remove();
        d3.select('#annotations').remove();
        d3.select('#barData').remove();
      });
      
      })
    }

    function displayChart() {
      const containerWidth = svgChart.attr("width");
      const containerHeight = svgChart.attr("height");
      const margin = {top: 50, right: 10, bottom: 10, left: 50};
      const chartWidth = containerWidth - margin.left - margin.right;
      const chartHeight = containerHeight - margin.top - margin.bottom;

      let chartArea = svgChart.append("g").attr("id","barData")
                         .attr("transform",`translate(${margin.left},${margin.top})`);
      let annotations = svgChart.append("g").attr("id","annotations");

      const names = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j'];
      const nameScale = d3.scaleBand().domain(names).range([chartHeight, 0]).padding(0.05);
      let leftAxis = d3.axisLeft(nameScale).tickFormat("");
      let leftGridlines = d3.axisLeft(nameScale).tickSize(-chartWidth-10).tickFormat("");

      annotations.append("g")
                  .attr("class", "y axis")
                  .attr("transform",`translate(${margin.left-10},${margin.top})`)
                  .call(leftAxis);
      annotations.append("g")
                  .attr("class", "y gridlines")
                  .attr("transform",`translate(${margin.left-10},${margin.top})`)
                  .call(leftGridlines);

      const salaryExtent = 1000;
      let bottomAxis = d3.scaleLinear().domain([0, salaryExtent]).range([0, chartWidth]);
      annotations.append("g")
                 .attr("class", "x axis")
                 .attr("transform",`translate(${margin.left},${chartHeight+margin.top+10})`)
                 .call(bottomAxis);
    }

    displayField();

    const slider = d3.select('input');
    slider.on('input', function() { 
      d3.select('b').text(this.value);
      year = this.value;
      displayField();

    });
    
  </script>
  
</body>
</html>