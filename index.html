<!DOCTYPE html>
<html>
<head>
  <script src='https://d3js.org/d3.v7.min.js'></script>
  <title>Project 2</title>
</head>
<body>
  <style>
    html {
      font-family: sans-serif;
    }

    /* used w3schools.com for slider styling inspo */
    .slider {
      -webkit-appearance: none;
      width: 30%;
      height: 10px;
      background: lightgrey;
      outline: none;
    }
    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 10px;
      height: 20px;
      background:#0E6738;
      cursor: pointer;
    }
  </style>

  
  <div style='padding: 5px 20px'>
    <div style='padding-bottom: 40px'>
      <p>
        Selected Year: <b>2016</b> <br/> 
        <span style='font-size: 12px'>Use the slider below to change the selected year.</span>
      </p>
      <input type='range' min='1985' max='2016' value='2016' step='1' class='slider'>  
    </div>
    
    <svg width=700 height=600 id='field'></svg>
    <svg width=500 height=600 id='barchart'>
      <text id='title' text-anchor='right' alignment-baseline='hanging'></text>
    </svg>
    
  </div>

  <script>
    const svgField = d3.select('svg#field');
    const svgChart = d3.select('svg#barchart');
    var year = 2016;

    // generated path using figma 
    const fieldPath = 'M350 0C175.629 0 30.5457 104.819 0 243.194L350 595.056L700 243.194C669.454 104.819 524.37 0 350 0Z'
    svgField.append('path')
       .attr('fill', '#9CC596')
       .attr('d', fieldPath)
    
    const positions = ['G_p', 'G_c', 'G_1b', 'G_2b', 'G_3b', 'G_ss', 'G_lf', 'G_cf', 'G_rf']
    const positionsOnField = {
      'G_p': {
        'x': 350,
        'y': 420,
        'name': 'Pitcher',
        'total salary': 0,
        'number of players': 0
      },
      'G_c': {
        'x': 350,
        'y': 560,
        'name': 'Catcher',
        'total salary': 0,
        'number of players': 0
      },
      'G_1b': {
        'x': 510,
        'y': 365,
        'name': 'First Baseman',
        'total salary': 0,
        'number of players': 0
      },
      'G_2b': {
        'x': 440,
        'y': 275,
        'name': 'Second Baseman',
        'total salary': 0,
        'number of players': 0
      },
      'G_3b': {
        'x': 190,
        'y': 365,
        'name': 'Third Baseman',
        'total salary': 0,
        'number of players': 0
      },
      'G_ss': {
        'x': 260,
        'y': 274,
        'name': 'Short Stop',
        'total salary': 0,
        'number of players': 0
      },
      'G_lf': {
        'x': 150,
        'y': 170,
        'name': 'Left Fielder',
        'total salary': 0,
        'number of players': 0
      },
      'G_cf': {
        'x': 350,
        'y': 105,
        'name': 'Center Fielder',
        'total salary': 0,
        'number of players': 0
      },
      'G_rf': {
        'x': 550,
        'y': 170,
        'name': 'Center Fielder',
        'total salary': 0,
        'number of players': 0
      }
    }

    d3.csv('csv-files/joined_data.csv').then( data => {
      data.forEach(d => {
        positions.forEach(pos => {
          if (Number(d[pos]) > 0) {
            positionsOnField[pos]['total salary'] = Number(d['salary']);
            positionsOnField[pos]['number of players'] ++;
          } 
        })
      });


      positions.forEach(pos => {
        positionsOnField[pos]['average salary'] = positionsOnField[pos]['total salary']/positionsOnField[pos]['number of players']
      })
      console.log(positionsOnField);

      const avgSalaryExtent = d3.extent(positions, d => positionsOnField[d]['average salary']);
      const avgSalaryScale = d3.scaleLinear().domain(avgSalaryExtent).range([0, 30]);

      const positionsCircles = svgField.selectAll('circle.positions').data(positions)
                                        .join('circle')
                                        .attr('cx', d => positionsOnField[d]['x'])
                                        .attr('cy', d => positionsOnField[d]['y'])
                                        .attr('r', d => avgSalaryScale(positionsOnField[d]['average salary']))
                                        .attr('id', d => d)
                                        .attr('class', 'positions')
                                        .attr('fill', 'steelblue')
                                        .attr('opacity', 0.5);
                                    

      positionsCircles.on('mouseover', function() {
        d3.select(this)
          .attr('opacity', 1)
          .attr('stroke', 'black')
          .attr('stroke-width', 2);
        const posID = d3.select(this).attr('id');
        const pos = positionsOnField[posID]['name'];
        d3.select('#title').text('Top 10 Highest Paid ' + pos + ' in ' + year)
          .style('font-size', 18);
        // const textBox = svgField.append('rect')
        //         .attr('x', 500)
        //         .attr('y', 500)
        //         .attr('width', 200)
        //         .attr('height', 100)
        //         .attr('fill', 'steelblue')
        //         .attr('opacity', 0.4)
        //         .attr('id', 'textBox')
        //         .style('border-radius', '10px');

        svgField.append('text')
                .attr('x', 450)
                .attr('y', 550)
                .text('average salary: $' + Math.floor(positionsOnField[posID]['average salary']) + '000')
                .attr('id', 'avgSalaryText')
      });

      positionsCircles.on('mouseout', function() {  
        d3.select(this)
          .attr('opacity', 0.5)
          .attr('stroke', 'none');      
        d3.select('#title').text('');
        d3.select('#avgSalaryText').remove();
      });

      const slider = d3.select('input');
      slider.on('input', function() { 
        d3.select('b').text(this.value);
        year = this.value;
      });
      
    })
  </script>
  
</body>
</html>